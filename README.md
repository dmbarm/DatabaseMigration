# MyMigrationTool

MyMigrationTool is a lightweight database migration library inspired by Liquibase and Flyway. It uses an XML configuration file to define forward migration steps along with rollback instructions, and it relies on HikariCP for efficient database connection pooling.

## Table of Contents
- [Overview](#overview)
- [Features](#features)
- [Project Structure](#project-structure)
- [Prerequisites](#prerequisites)
- [Installation](#installation)
- [Configuration](#configuration)
- [Usage](#usage)
- [License](#license)

## Overview

MyMigrationTool allows you to manage and version your database schema changes systematically.  
The tool:

- Parses an XML file containing migration definitions.
- Executes forward migrations (e.g., creating tables, adding columns, modifying column types) and tracks them in a database table.
- Supports rollback functionality by storing reverse operations in the migration XML.
- Utilizes HikariCP for efficient database connection pooling.
- Can be extended to support additional migration actions such as renaming, altering constraints, and executing raw SQL.

This tool is useful for developers who need a simple yet robust mechanism for database schema evolution, and who want to manage rollbacks in a clean, auditable manner.

## Features

- **XML-Based Migrations:** Define each migration as a `<migration>` element with forward actions and a rollback block.
- **Forward & Rollback Actions:** Each migration includes both instructions to apply changes and to reverse them.
- **Connection Pooling:** Utilizes HikariCP, configured via a `database.properties` file.
- **Migration Tracking:** A dedicated `migrations_history` table logs each migration to prevent re-application.
- **Extensible Architecture:** Designed to be extended with new migration actions (e.g., renaming columns, adding indexes).
- **Logging:** Uses SLF4J for logging, which can be configured with Logback or Log4j.

## Project Structure

- my-migration-tool/
	- `pom.xml` — Maven build file with dependencies (HikariCP, SLF4J, etc.)
	- `README.md` — Project documentation
    - `LICENSE` — Project license
    - `src/`
      - `main/`
        - `java/`
          - `org/MigrationTool/`
            - `Main/` — Main application entry point
              - **Main.java**
            - `Models/` — Model classes (e.g., Column, Constraints)
            - `Actions/` — Migration actions (e.g., CreateTableAction, AddColumnAction, etc.)
            - `Parsers/` — XML parsing logic (e.g., MigrationParser.java)
            - `Utils/` — Utility classes (e.g., AttributeNames, etc.)
            - `resources/`
              - **database.properties** — Database connection configuration (JDBC URL, user, password, etc.)
              - `migrations/` — Folder for migration XML files (or individual SQL files)
              - **migrations.xml** — Example XML file containing migration definitions
    - `target/` — Build output directory (generated by Maven)

## Prerequisites

- **Java 17 or above**
- **Maven 3.6+**
- A relational database (H2, PostgreSQL, MySQL, etc.).  
  *(For testing, the default configuration uses H2 in-memory.)*

## Installation

1. **Clone the repository:**

   ```bash
   git clone https://github.com/yourusername/my-migration-tool.git
   cd my-migration-tool
   ```
   
2. **Build the project using Maven:**
    ```bash
    mvn clean compile
    ```
## Configuration

### Database connection
The database.properties file (located in src/main/resources/) holds the database connection details and pooling configuration:
```properties
# database.properties
database.url=jdbc:h2:mem:testdb
database.user=sa
database.password=
database.pool.size=10
migration.folder=src/main/resources/migrations
```

For a persistent database (e.g., PostgreSQL), update the JDBC URL and credentials accordingly:  
```properties
database.url=jdbc:postgresql://localhost:5432/mydatabase
database.user=myuser
database.password=mypassword
database.pool.size=10
migration.folder=src/main/resources/migrations
```

### Migration definitions
Migrations are defined in an XML file (for example, migrations.xml) that outlines each change and its rollback instructions. Here’s an example snippet:  
```xml
<migrations>
    <migration id="1" author="dmitriy">
        <createTable tableName="users">
            <column columnName="id" columnType="int">
                <constraints auto_increment="true" primaryKey="true" nullable="false"/>
            </column>
            <column columnName="name" columnType="varchar(100)">
                <constraints nullable="false"/>
            </column>
        </createTable>
        <rollback>
            <dropTable tableName="users"/>
        </rollback>
    </migration>
    <!-- More migrations can be defined here -->
</migrations>
```

## Usage
1.	**Ensure the migrations_history Table Exists:**  
    The tool will initialize a tracking table in your database (if it does not already exist) to log applied migrations.
2.	**Run the Migration Tool:**  
    Execute the main class to parse the migration XML file, run the migrations, and log the results:
3.	**Rollback Migrations:**
    If you need to roll back a migration, the tool will use the rollback instructions defined in the XML. Your application code should support triggering a rollback (either fully or step-by-step).
    (Refer to the code comments and documentation for details on invoking rollbacks.)
4.	**Verify Applied Migrations:**
    Check the contents of the migrations_history table in your database to see which migrations have been executed.

## License
This project is licensed under the MIT License – see the LICENSE file for details.